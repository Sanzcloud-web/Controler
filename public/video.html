<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Player - Remote Control</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            background-color: #000;
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            width: 100%;
            max-width: 900px;
        }

        video {
            width: 100%;
            height: auto;
            border-radius: 8px;
            background-color: #1a1a1a;
        }

        .controls {
            margin-top: 20px;
            background: linear-gradient(135deg, #1a1a1a 0%, #2a2a2a 100%);
            padding: 20px;
            border-radius: 8px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            align-items: center;
        }

        .info {
            flex: 1;
            color: #888;
            font-size: 14px;
            min-width: 200px;
        }

        .time {
            color: #fff;
            font-weight: bold;
            font-family: monospace;
        }

        .status {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 4px;
            font-size: 12px;
            color: #666;
        }

        .status.connected {
            color: #4ade80;
            background: rgba(74, 222, 128, 0.1);
        }

        .status.disconnected {
            color: #ef4444;
            background: rgba(239, 68, 68, 0.1);
        }
    </style>
</head>
<body>
    <div class="container">
        <video id="videoPlayer" controls autoplay playsinline>
            <source src="https://www.w3schools.com/html/mov_bbb.mp4" type="video/mp4">
            Your browser does not support the video tag.
        </video>

        <div class="controls">
            <div class="info">
                <div>
                    <span class="time" id="currentTime">00:00</span> / <span class="time" id="duration">00:00</span>
                </div>
                <div>Volume: <span class="time" id="volumeDisplay">100%</span></div>
                <div class="status" id="status">Connecting...</div>
            </div>
        </div>
    </div>

    <script>
        const video = document.getElementById('videoPlayer');
        const statusEl = document.getElementById('status');
        const currentTimeEl = document.getElementById('currentTime');
        const durationEl = document.getElementById('duration');
        const volumeDisplay = document.getElementById('volumeDisplay');

        let ws = null;
        let wsRetries = 0;
        const maxRetries = 5;

        function formatTime(seconds) {
            const hours = Math.floor(seconds / 3600);
            const minutes = Math.floor((seconds % 3600) / 60);
            const secs = Math.floor(seconds % 60);
            
            if (hours > 0) {
                return `${hours}:${minutes.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
            }
            return `${minutes}:${secs.toString().padStart(2, '0')}`;
        }

        function updateTimeDisplay() {
            currentTimeEl.textContent = formatTime(video.currentTime);
            durationEl.textContent = formatTime(video.duration);
        }

        function connectWebSocket() {
            const protocol = window.location.protocol === 'https:' ? 'wss:' : 'ws:';
            const wsUrl = `${protocol}//${window.location.host}/ws`;
            
            ws = new WebSocket(wsUrl);

            ws.onopen = () => {
                console.log('WebSocket connected');
                statusEl.textContent = 'Connected to remote control';
                statusEl.classList.add('connected');
                statusEl.classList.remove('disconnected');
                wsRetries = 0;
            };

            ws.onmessage = (event) => {
                try {
                    const cmd = JSON.parse(event.data);
                    handleVideoCommand(cmd);
                } catch (e) {
                    console.error('Failed to parse command:', e);
                }
            };

            ws.onerror = (error) => {
                console.error('WebSocket error:', error);
                statusEl.textContent = 'Error connecting to remote control';
                statusEl.classList.add('disconnected');
                statusEl.classList.remove('connected');
            };

            ws.onclose = () => {
                console.log('WebSocket disconnected');
                statusEl.textContent = 'Disconnected from remote control';
                statusEl.classList.add('disconnected');
                statusEl.classList.remove('connected');
                
                // Retry connection
                if (wsRetries < maxRetries) {
                    wsRetries++;
                    setTimeout(() => {
                        console.log(`Retrying WebSocket connection (${wsRetries}/${maxRetries})...`);
                        connectWebSocket();
                    }, 2000);
                }
            };
        }

        function handleVideoCommand(cmd) {
            console.log('Received command:', cmd);
            
            switch (cmd.command) {
                case 'play':
                    video.play();
                    break;
                case 'pause':
                    video.pause();
                    break;
                case 'togglePlayPause':
                    if (video.paused) {
                        video.play();
                    } else {
                        video.pause();
                    }
                    break;
                case 'setVolume':
                    if (cmd.value !== undefined) {
                        video.volume = Math.max(0, Math.min(1, cmd.value / 100));
                        volumeDisplay.textContent = Math.round(video.volume * 100) + '%';
                    }
                    break;
                case 'seek':
                    if (cmd.value !== undefined) {
                        video.currentTime = cmd.value;
                    }
                    break;
                case 'skipForward':
                    video.currentTime = Math.min(video.duration, video.currentTime + 10);
                    break;
                case 'skipBackward':
                    video.currentTime = Math.max(0, video.currentTime - 10);
                    break;
                case 'increaseVolume':
                    video.volume = Math.min(1, video.volume + 0.05);
                    volumeDisplay.textContent = Math.round(video.volume * 100) + '%';
                    break;
                case 'decreaseVolume':
                    video.volume = Math.max(0, video.volume - 0.05);
                    volumeDisplay.textContent = Math.round(video.volume * 100) + '%';
                    break;
                case 'fullscreen':
                    if (document.fullscreenElement) {
                        document.exitFullscreen();
                    } else {
                        video.requestFullscreen();
                    }
                    break;
            }
        }

        // Update time display when video metadata is loaded or during playback
        video.addEventListener('loadedmetadata', updateTimeDisplay);
        video.addEventListener('timeupdate', updateTimeDisplay);
        video.addEventListener('volumechange', () => {
            volumeDisplay.textContent = Math.round(video.volume * 100) + '%';
        });

        // Connect to WebSocket on load
        window.addEventListener('load', connectWebSocket);

        // Reconnect on visibility change
        document.addEventListener('visibilitychange', () => {
            if (!document.hidden && (!ws || ws.readyState !== WebSocket.OPEN)) {
                connectWebSocket();
            }
        });
    </script>
</body>
</html>
